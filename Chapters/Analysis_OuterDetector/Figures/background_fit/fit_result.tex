\begin{figure}[]%
\centering
\begin{tikzpicture}
\centering
    \begin{groupplot}[
    group style = {group size = 1 by 2,vertical sep=1.0cm}
    ]
    \nextgroupplot[
            ylabel=Rate (Hz/5phd),
            xlabel=,
            xmajorticks=false,
            width=15cm,
            height=10cm,
            grid=major,
            xmin=20, xmax=600,
            ymin=1e-2, ymax=100,
            ymode=log,
            legend style = { column sep = 10pt, legend columns = 3, cells={line width=1.5pt}}
            ]
        \addplot[black, only marks, mark size=1.0pt, error bar legend,
                 error bars/.cd, error bar style={color=black},
                 y dir=both, y explicit, 
                 x dir=both, x explicit,] 
            table[x=pulsearea,y=weight,x error=xerror, y error=yerror]
            {Data/OD_Backgrounds/background_constraints/od_data.dat};
        \addlegendentry{data};
            
        \addplot[const plot, teal]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/rg_k40.dat};
        \addlegendentry{Cavern ${}^{40}$K};
        \addplot[const plot, cyan]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/rg_u238.dat};
        \addlegendentry{Cavern ${}^{238}$U};
        \addplot[const plot, green]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/rg_th232.dat};
        \addlegendentry{Cavern ${}^{232}$Th};
        \addplot[const plot, lime]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/ocv.dat};
        \addlegendentry{Detector};
        \addplot[const plot, yellow]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/Internal_improved_u238_early.dat};
        \addlegendentry{${}^{238}$U early};
        \addplot[const plot, pink]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/Internal_improved_u238_late.dat};
        \addlegendentry{${}^{238}$U late};    
        \addplot[const plot, olive]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/Internal_improved_th232_early.dat};
        \addlegendentry{${}^{232}$Th early};
        \addplot[const plot, brown]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/Internal_improved_C14.dat};
        \addlegendentry{${}^{14}$C};
        \addplot[const plot, orange]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/Internal_improved_Gd152.dat};
        \addlegendentry{${}^{152}$Gd + ${}^{147}$Sm};
        \addplot[const plot, violet]
            table [x=bin_low, y=weight]
            {Data/OD_Backgrounds/background_fit/fit_components/total_fit.dat};
        \addlegendentry{fit};
            
            
    \nextgroupplot[
            ylabel=Ratio (data/fit),
            xlabel=Pulse Area (phd),
            width=15cm,
            height=5cm,
            grid=major,
            xmin=20, xmax=600,
            ymin=0, ymax=2,
            ]
        \addplot[only marks, mark size=1.0pt, black, error bar legend] 
            plot[error bars/.cd, y dir=both, y explicit]
            table[x=bin,y=value, y error=error]
            {Data/OD_Backgrounds/background_fit/fit_components/ratio.dat};
        
        %\addplot[black, mark=none, dashed] coordinates {(20,-1) (20,3)};
        %\addplot[black, mark=none, dashed] coordinates {(600,-1) (600,3)};
        
    \end{groupplot}
\end{tikzpicture}
    \caption{Result of fit to data.
             \textbf{Top:} Contribution from each source. Only components with a contribution greater than 1 Hz have been included.
             \textbf{Bottom:} Ratio of fit to data. 
             In generally there is good agreement.}
    \label{fig:od_background_fit_to_data}
\end{figure}